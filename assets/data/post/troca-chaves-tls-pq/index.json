{"hash":"dd35e2be7b007ce0c3d6e3dd715b9173e50f35f6","data":{"post":{"title":"Troca de chaves com TLS utilizando criptografia pós quântica","date":"28/07/2022","content":"<h2 id=\"introdução\"><a href=\"#introdu%C3%A7%C3%A3o\" aria-hidden=\"true\"><span class=\"icon icon-link heading-anchor\"></span></a>Introdução</h2>\n<p>Desde que se descobriu o potencial de criptoanálise do computador quântico,\nespecialmente com o algoritmo de Shor, criou-se a idéia de que a criptografia\nmoderna se tornaria inútil assim que esse tipo de computador começasse a ser\ndesenvolvido em larga escala. Com isso, todas as mensagens trocadas com o\nuso de algoritmos criptográficos atuais seriam facilmente interceptáveis.</p>\n<p>Desse modo, a troca de chaves que é um método de criptografia para trocas de chaves de maneira segura em canal público. Entretanto, deixaria de ser pois estaria utilizando um protocolo que poderia ser descriptografado por um computador quântico.</p>\n<p>Em resposta a isso, surgiu a criptografia pós-quântica, ramo da criptografia que estuda classes de algoritmos criptográficos resistentes à criptoanálise quântica. Como exemplos de classes de algoritmos, podemos mencionar os baseados em hash, os baseados em látice, os baseados em códigos, entre outros. Estes algoritmos demorariam um tempo exponencial para serem quebrados, mesmo em computadores quânticos.</p>\n<p>O TLS (Transport Layer Security) assim como o seu antecessor SSL(Secure Sockets Layer) é um protocolo de segurança projetado para fornecer segurança nas comunicações sobre uma rede de computadores. O protocolo TLS, que atualmente está na versão 1.2, visa principalmente fornecer privacidade e integridade de dados entre dois ou mais aplicativos de computador que se comunicam. Entretanto, com o surgimento da computação quântica, uma nova ameaça ao problemas de segurança surge.</p>\n<p>Contextualizado os itens acima, em sequência será apresentado e experimentado a troca de chaves utilizando o protocolo TLS, será utilizado o projeto de código aberto Open Quantum Safe (OQS) que fornece algoritmos finalistas no NIST empacotados na biblioteca liboqs.</p>\n<h2 id=\"conceitos\"><a href=\"#conceitos\" aria-hidden=\"true\"><span class=\"icon icon-link heading-anchor\"></span></a>Conceitos</h2>\n<p>A troca de chave hı́brida refere-se ao uso de vários algoritmos de troca de\nchave simultaneamente e à combinação do resultado com o objetivo de forne-\ncer segurança, mesmo que todos os algoritmos do componente, exceto um, es-\ntejam quebrados. É motivado pela transição para a criptografia pós-quântica.\nDenominado como Transport Layer Security (TLS) versão 1.3.</p>\n<p>Troca de chave ”hı́brida”, significa o uso de dois, ou mais algoritmos de troca de chave com base em diferentes suposições criptográficas, por exemplo, um algoritmo tradicional e um algoritmo de última geração. O principal objetivo é facilitar o estabelecimento de um segredo compartilhado que permaneça seguro enquanto um dos mecanismos de troca de chave permanecer intacto.</p>\n<h3 id=\"encapsulamento\"><a href=\"#encapsulamento\" aria-hidden=\"true\"><span class=\"icon icon-link heading-anchor\"></span></a>Encapsulamento</h3>\n<p>Os algoritmos de troca de chaves são formulados como mecanismos de en-\ncapsulamento de chaves, sendo eles:</p>\n<ul>\n<li>KeyGen: Geração probabilı́stica, chave pública pk e chave secreta sk.</li>\n<li>Encaps: Encapsulamento probabilı́stico, recebe como entrada uma chave\npk, e gera um texto cifrado ct e segredo compartilhado ss.</li>\n<li>Decaps: Desencapsulamento que recebe como entrada uma chave sk e\ntexto cifrado ct, gerando um texto compartilhado ss.</li>\n</ul>\n<h3 id=\"construção-da-troca\"><a href=\"#constru%C3%A7%C3%A3o-da-troca\" aria-hidden=\"true\"><span class=\"icon icon-link heading-anchor\"></span></a>Construção da troca</h3>\n<ul>\n<li>Negociação: Para cada combinação particular de algoritmos em um\ntroca de será representada por um grupo nomeado. Cada valor que\nrepresenta uma troca de chave corresponderá a um par ordenado de\ndois algoritmos.</li>\n<li>Transmissão: As mensagens serão concatenadas e transmitidas como\num único valor.</li>\n<li>Cálculo de segredo compartilhado: Os dois segredos compartilhados são\nconcatenados. Inserindo no cronograma de chave no local do segredo\ncompartilhado (EC)DHE.</li>\n</ul>\n<p>A biblioteca liboqs fornece os principais mecanismos para encapsulamento\nde chaves, conforme citado no item 2.1, sendo denotadas como:</p>\n<ul>\n<li>OQS KEM keypar: Gera um par de chaves pública/privada para\ntroca de chaves.</li>\n<li>OQS KEM encaps: Gera uma chave pública para a outra parte e um\nsegredo compartilhado para o requisitante.</li>\n<li>OQS KEM decaps: Gera um valor secreto compartilhado usando a\nchave pública da outra parte e sua própria chave privada.</li>\n</ul>\n<p>Aplicando essas funcionalidades da biblioteca, é possı́vel encontrar o seguinte fluxo:</p>\n<p><img src=\"https://raw.githubusercontent.com/rafaelbcastilhos/rafaelbcastilhos.github.io/master/post/images/troca-chave-tls-pq-fluxo.png\" alt=\"Fluxograma\"></p>\n<h2 id=\"experimento\"><a href=\"#experimento\" aria-hidden=\"true\"><span class=\"icon icon-link heading-anchor\"></span></a>Experimento</h2>\n<p>O experimento será executado em um notebook com sistema operacional Linux Ubuntu, todos os procedimentos citados a seguir também poderão ser executados em outros sistemas operacionais, porém haverá diferença em alguns comandos que são especiais do Linux. Preambularmente, iremos precisar realizar o download do programa Wireshark que é um programa que analisa o tráfego da rede e organiza por protocolos. Também iremos precisar baixar a biblioteca liboqs e a biblioteca wolfSSL.</p>\n<h3 id=\"instalação-e-construção\"><a href=\"#instala%C3%A7%C3%A3o-e-constru%C3%A7%C3%A3o\" aria-hidden=\"true\"><span class=\"icon icon-link heading-anchor\"></span></a>Instalação e construção</h3>\n<p>Para baixar o Wireshark é necessário executar:</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440ff\"><code><span class=\"line\"><span style=\"color: #d8dee9ff\">sudo apt-get install wireshark</span></span></code></pre>\n<p>Após instalado, deve ser iniciado, executando o comando:</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440ff\"><code><span class=\"line\"><span style=\"color: #d8dee9ff\">sudo wireshark</span></span></code></pre>\n<p>Para realizar download e construção do liboqs, execute:</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440ff\"><code><span class=\"line\"><span style=\"color: #d8dee9ff\">wget https://github.com/open-quantum-safe/liboqs/archive/refs/tags/0.7.0.tar.gz\n\ntar xf 0.7.0.tar.gz\n\ncd liboqs-0.7.0\n\nmkdir build\n\ncd build\n\ncmake -DOQS_USE_OPENSSL=0 ..\n\nmake all\n\nsudo make install</span></span></code></pre>\n<p>Para realizar download e construção do wolfSSL, execute:</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440ff\"><code><span class=\"line\"><span style=\"color: #d8dee9ff\">git clone https://github.com/wolfssl/wolfssl\n\ncd wolfssl\n\n./autogen.sh\n\n./configure --with-liboqs\n\nmake all\n\nsudo make install</span></span></code></pre>\n<h3 id=\"execução\"><a href=\"#execu%C3%A7%C3%A3o\" aria-hidden=\"true\"><span class=\"icon icon-link heading-anchor\"></span></a>Execução</h3>\n<p>Em seguida, vamos estabelecer uma comunicação TLS entre um exemplo de servidor e um exemplo de cliente. Para isso, é necessário abrir duas janelas no terminal, uma para o servidor, outra para o cliente. Nesse momento, certifique-se que o Wireshark está aberto e clique no botão para iniciar captura de pacotes.</p>\n<p>Agora é necessário especificar o inı́cio do servidor para troca de chaves\nhı́bridas ECC-P521 e Kyber Level 5, em uma janela do terminal:</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440ff\"><code><span class=\"line\"><span style=\"color: #d8dee9ff\">./examples/server/server -v 4 --pqc P521_KYBER_LEVEL5</span></span></code></pre>\n<p>Na outra janela do terminal, execute a conexão do cliente:</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440ff\"><code><span class=\"line\"><span style=\"color: #d8dee9ff\">./examples/client/client -v 4 --pqc P521_KYBER_LEVEL5</span></span></code></pre>\n<p>O servidor e o cliente realizam uma conexão TLS e uma comunicação com mensagem de ida e volta. Cada janela exibe informações de conexão TLS 1.3 com as seguintes mensagens:</p>\n<p><img src=\"https://raw.githubusercontent.com/rafaelbcastilhos/rafaelbcastilhos.github.io/master/post/images/troca-chave-tls-pq-servidor.png\" alt=\"Servidor\"></p>\n<p><img src=\"https://raw.githubusercontent.com/rafaelbcastilhos/rafaelbcastilhos.github.io/master/post/images/troca-chave-tls-pq-cliente.png\" alt=\"Cliente\"></p>\n<p>Após realizar a conexão, é possı́vel verificar os pacotes no Wireshark, filtrando apenas os pacotes que utilizam TLS, de acordo com a figura abaixo:</p>\n<p><img src=\"https://raw.githubusercontent.com/rafaelbcastilhos/rafaelbcastilhos.github.io/master/post/images/troca-chave-tls-pq-wireshark.png\" alt=\"Wireshark\"></p>\n<p>E também constatar o acontecimento do handshake, Client Hello e Server Hello, na imagem abaixo é demonstrado com detalhes as propriedades do TLS no pacote Server Hello:</p>\n<p><img src=\"https://raw.githubusercontent.com/rafaelbcastilhos/rafaelbcastilhos.github.io/master/post/images/troca-chave-tls-pq-pacote.png\" alt=\"Pacote Wireshark\"></p>\n<h2 id=\"análise-e-conclusões\"><a href=\"#an%C3%A1lise-e-conclus%C3%B5es\" aria-hidden=\"true\"><span class=\"icon icon-link heading-anchor\"></span></a>Análise e conclusões</h2>\n<p>Portanto, após realizar testes e executar o programa de benchmark disponibilizado pela wolfSSL por meio do comando:</p>\n<pre class=\"shiki\" style=\"background-color: #2e3440ff\"><code><span class=\"line\"><span style=\"color: #d8dee9ff\">./wolfcrypt/benchmark/benchmark</span></span></code></pre>\n<p>Se torna possı́vel constatar que os tempos de processamento desses algoritmos\nestão entrando em um intervalo comparável aos algoritmos atuais, mas ainda\nnão são iguais ou inferiores.</p>\n<p>É possı́vel concluir que os segredos compartilhados calculados na troca\nde chave hı́brida devem ser calculados de uma maneira que atinja a propriedade ”hı́brida”: o segredo resultante é seguro desde que pelo menos um dos algoritmos de troca de chave componente esteja intacto.</p>\n"}},"context":{}}